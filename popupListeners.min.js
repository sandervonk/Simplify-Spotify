var lastRan=-1,timeoutId=0,simplifySetting={};function removeItemAll(arr,value){for(var i=0;i<arr.length;)arr[i]===value?arr.splice(i,1):++i;return arr}function addRemoveListener(){setTimeout((function(){for(remove_btn of document.getElementsByClassName("remove-custom")){let btn_parent=remove_btn.parentElement,btn_playlist_id=btn_parent.id.replace("spotify-playlist-","");remove_btn.addEventListener("click",(function(){btn_parent.remove(),simplifySetting["custom-playlists"]=removeItemAll(simplifySetting["custom-playlists"],btn_playlist_id),chrome.storage.sync.set(simplifySetting,(function(response){console.log("changed saved playlists to version with removed playlist:"),console.log(simplifySetting["custom-playlists"])}))}))}}),200)}function addCustomsListener(){setTimeout((function(){document.getElementById("addCustomButton").addEventListener("click",(function(){let playlist_input=document.getElementById("playlist-input").value,playlistID=playlist_input.split("playlist:")[playlist_input.split("playlist:").length-1];if(playlistID=playlistID.split("/playlist/")[playlist_input.split("/playlist/").length-1],playlistID=playlistID.split("?")[0],document.getElementById("playlist-input").value="",-1===simplifySetting["custom-playlists"].indexOf(playlistID)){simplifySetting["custom-playlists"].push(playlistID);let customs=simplifySetting["custom-playlists"];chrome.storage.sync.set(simplifySetting,(function(reply){console.log("saved playlists to storage"),console.log("saved new custom with reply:"),console.log(reply),console.log(customs),setTimeout((function(){window.location.href+="?new-custom"}),100)}))}else console.log("playlist already added")})),document.getElementById("playlist-input").addEventListener("input",(function(){let addPlaylistInputs=document.getElementsByClassName("addPlaylistInputs")[0],playlist_input=document.getElementById("playlist-input").value,playlistID=playlist_input.split("playlist:")[playlist_input.split("playlist:").length-1];playlistID=playlistID.split("/playlist/")[playlist_input.split("/playlist/").length-1],playlistID=playlistID.split("?")[0],playlist_input.includes("/album/")||playlist_input.includes("album:")?document.getElementById("playlist-preview").innerHTML='<div class="centered-info">Sorry, albums are not currently supported</div>':-1===simplifySetting["custom-playlists"].indexOf(playlistID)?spotifyApi.getPlaylist(playlistID).then(playlistData=>{let previewElement=playlistTemplate(playlistData);document.getElementById("playlist-preview").innerHTML=previewElement,document.getElementById("addCustomButton").style.display="block"}).catch(error=>{document.getElementById("playlist-preview").innerHTML='<div class="centered-info">Sorry, that\'s not a valid playlist</div>',console.warn("Not a playlist, passed err",error),setTimeout((function(){document.getElementById("addCustomButton").style.display="none"}),100)}):document.getElementById("playlist-preview").innerHTML='<div class="centered-info"><b>Playlist Already Added</b></div>'}))}),500)}function initListeners(){var playlistTemplate=function(playlist,isCustom){return 2!=arguments.length&&(isCustom=!1),templateComplete=`\n        <div class="simplify-playlist" id="spotify-playlist-${playlist.id}">\n            <div class="simplify-playlist-img">\n                <img src="${playlist.images[0].url}">\n                <div class="start-parent">\n                    <a href="?${playlist.uri.replace("spotify:","")}"><div class="start-button">&#9654;</div></a>    \n                </div>  \n            </div>\n            <div class="simplify-playlist-content">\n                <div class="playlist-title">${playlist.name}</div>\n                <div style="${playlist.description.length>0?"":"display: none"}" class="playlist-description">"${playlist.description}"</div>\n                <div class="playlist-details">${[playlist.owner.display_name,playlist.tracks.total+" tracks",(playlist.public>0?"public":"private")+(playlist.collaborative>0?" (collab)":"")].join(" <b>&centerdot;</b> ")}\n                </div>\n            </div>\n            ${isCustom?"<div class='remove-custom'>-</div>":""}\n        </div>`,templateComplete};function createPlaylists(playlistsInput){document.getElementsByTagName("html")[0].style="width: 400px; height: 600px",console.log("PLAYLISTS:"),console.log(playlistsInput);let playlistElements=`<div id="playlist-background" style="background-image: url(${lastImg})"></div>`;if(playlistsInput.length>1)for(playlist of playlistsInput)playlistElements+=playlistTemplate(playlist);else playlistElements+=playlistTemplate(playlist);return playlistElements}var deviceTemplate=function(device){return console.log("template got device:"),console.log(device),device.name.includes("Web Player")&&(device.type="browser"),deviceIcon="img/devices/48/"+device.type+".png",device.volume>75?speakerImg="3":device.volume>50?speakerImg="2":device.volume>25?speakerImg="1":device.volume>=1?speakerImg="0":speakerImg="Mute",filter=device.active?"filter: brightness(4) sepia(1) hue-rotate(72deg) saturate(4000%) !important":"",device.active&&(filter="browser"===device.type?"filter: brightness(175) sepia(1) hue-rotate(72deg) saturate(10000%) !important":filter),sliderType=device.active?`<input type="range" min="0" max="100" value="${device.volume}" class="vol-slider slider" id="volSlider">`:`<div class="volume-bar" style="width: ${device.volume}%;"></div>`,`\n        <div class='spotify-device active-${device.active}'>\n            <div class="device-icon" style="${filter}" title="${device.type.replace(/(^\w{1})|(\s+\w{1})/g,letter=>letter.toUpperCase())}">\n                <a href="?device:${device.id}"><img src="${deviceIcon}"></a>\n            </div>\n            <div class="device-volume" title="Volume: ${device.volume}%">\n                <img src="img/speaker/speaker${speakerImg}.png">\n                <div class="volume-parent">\n                    <div class="volume">\n                        ${sliderType}\n                    </div>\n                </div>\n            </div>\n            <div class="device-name">\n                <div class="name-child">${device.name}</div>\n            </div>\n        </div>`};function reloadSettings(simplifySetting){for(currentSetting of("none"!==simplifySetting["setting-filter"]?(document.getElementById("js-setting-filter").className+=" active",console.log("enabled filter icon")):(document.getElementById("js-setting-filter").className=document.getElementById("js-setting-filter").className.replace(" active",""),console.log("disabled filter icon")),playlistType=`js-setting-playlist-type-${simplifySetting["setting-playlist-type"]}`,theme=`js-setting-theme-${simplifySetting["setting-theme"]}`,[playlistType,theme])){parentSelector=currentSetting.split("-"),parentSelector.pop(),parentSelector=parentSelector.join("-"),parentObj=document.getElementById(parentSelector);try{for(settingChild of parentObj.children)settingChild.className=settingChild.className.replace(" active","")}catch{}document.getElementById(currentSetting).className+=" active"}chrome.storage.sync.set(simplifySetting,(function(response){console.log("set settings, settings:"),console.log(simplifySetting)})),applySettings()}function applySettings(){"none"!==simplifySetting["setting-filter"]?document.body.className+=" black-and-white":document.body.className=document.body.className.replace(" black-and-white","")}document.getElementById("skip-back").addEventListener("click",(function(){spotifyApi.skipToPrevious()})),document.getElementById("js-status-play-pause").addEventListener("click",(function(){document.getElementById("js-status-play-pause").className.includes("paused")?spotifyApi.play():spotifyApi.pause()})),document.getElementById("skip-forward").addEventListener("click",(function(){spotifyApi.skipToNext()})),document.getElementsByClassName("progress-duration")[0].addEventListener("click",(function(){spotifyApi.getMyCurrentPlaybackState().then(response=>spotifyApi.seek(response.progress_ms+15e3))})),document.getElementsByClassName("progress-time")[0].addEventListener("click",(function(){spotifyApi.getMyCurrentPlaybackState().then(response=>spotifyApi.seek(response.progress_ms-15e3))})),document.getElementsByClassName("devices-icon")[0].addEventListener("click",(function(){icon=document.getElementsByClassName("devices-icon")[0],overlay=document.getElementsByClassName("devices-container")[0],parent=document.getElementsByClassName("devices-parent")[0],icon.className.includes("open-devices")?(icon.className="devices-icon close-devices",overlay.style.display="block",spotifyApi.getMyDevices().then(response=>{for(device of(deviceInfo={},response.devices))deviceInfo[device.name]={type:device.type.toLowerCase(),name:device.name,active:device.is_active,private:device.is_private_session,volume:device.volume_percent,id:device.id};for(device of(console.log(deviceInfo),devicesElement="",Object.keys(deviceInfo)))templateDevice=deviceInfo[device],devicesElement+=deviceTemplate(templateDevice);parent.innerHTML=devicesElement,setTimeout((function(){try{activeSlider=document.querySelector(".active-true .vol-slider"),activeSlider.addEventListener("input",(function(){value=activeSlider.value;try{window.clearTimeout(timeoutId)}catch{console.log("no timeouts")}lastId=timeoutId,timeoutId=window.setTimeout((function(){run=lastRan!=timeoutId,lastRan=timeoutId,setTimeout((function(){console.log("set volume"),value>75?speakerImg="3":value>50?speakerImg="2":value>25?speakerImg="1":value>=1?speakerImg="0":speakerImg="Mute",newParent=document.querySelector(".spotify-device.active-true div.device-volume > img"),newParent.src=`img/speaker/speaker${speakerImg}.png`,run&&spotifyApi.setVolume(value,(function(){console.log("ran timeout",timeoutId)}))}),100)}),100)}))}catch{}}),500)})):(icon.className="devices-icon open-devices",overlay.style.display="none")})),document.getElementsByClassName("settings-icon")[0].addEventListener("click",(function(){icon=document.getElementsByClassName("settings-icon")[0],overlay=document.getElementsByClassName("settings-container")[0],icon.className.includes("open-settings")?(icon.className="settings-icon close-settings",overlay.style.display="flex"):(icon.className="settings-icon open-settings",overlay.style.display="none")})),document.getElementsByClassName("playlist-icon")[0].addEventListener("click",(function(){if(icon=document.getElementsByClassName("playlist-icon")[0],overlay=document.getElementsByClassName("playlists-container")[0],icon.className.includes("open-playlists"))if("custom"!==simplifySetting["setting-playlist-type"])Promise.all([spotifyApi.getFeaturedPlaylists(),spotifyApi.getUserPlaylists(),spotifyApi.getPlaylist("37i9dQZEVXbMDoHDwVN2tF"),spotifyApi.getPlaylist("37i9dQZF1DXcBWIGoYBM5M")]).then(playlists=>{for(featurePlaylist of(playlists.feature=playlists[0].playlists.items,playlists.user=playlists[1].items,playlists.trending=[playlists[2],playlists[3]],playlists.feature))featurePlaylist.public=!0;playlists.shift(),playlists.shift(),playlists.shift(),playlists.shift(),console.log(playlists),"user"===simplifySetting["setting-playlist-type"]?playlistsList=playlists.user:"trending"===simplifySetting["setting-playlist-type"]?playlistsList=playlists.trending:playlistsList=playlists.feature,overlay.innerHTML=createPlaylists(playlistsList),overlay.style.display="block",icon.src="img/player.png",icon.className="playlist-icon close-playlists"});else{custom_playlists=simplifySetting["custom-playlists"],icon=document.getElementsByClassName("playlist-icon")[0],overlay=document.getElementsByClassName("playlists-container")[0],custom_playlists=simplifySetting["custom-playlists"],overlay.innerHTML="",console.error("Sorry, custom playlists are not yet fully supported :(, please select another source");let addElement='\n                <div class="simplify-playlist add-element">\n                    <div class="simplify-playlist-img" style="">+</div>\n                    <div class="simplify-playlist-content">\n                        <div class="playlist-title" style="font-size: 25px;">Add a Playlist</div>\n                    </div>\n                </div>',addBox='\n                <div class="simplify-playlist addPlaylistInputs" style="display: block !important; height: fit-content;min-height: 30px;justify-content: space-between;padding: 0px;font-size: 20px;text-align: left;">\n                    <div style="display: flex; padding: 10px;">\n                        Playlist URI or Share link\n                        <input type="text" id="playlist-input" style="" placeholder="spotify:playlist:id-here">\n                    </div>\n                    <div style="display: block; font-size: 10px; padding: 10px; padding-top: 0px; margin-top: 0px;"> \n                        Playlist Preview:\n                        <div style="width: 100%;"></div>\n                    </div>\n                    <div id="playlist-preview" style="height: 70px; padding: 5px; width: 100%; border-radius: 15px; border: grey solid thin;"></div>\n                </div>\n                <div class="addCustomButton" id="addCustomButton" style="display: none;">+</div>\n                ';if(1===custom_playlists.length)console.log("one custom playlist"),spotifyApi.getPlaylist(custom_playlists).then(playlistInfo=>{console.log(`got playlist by id ${custom_playlists}:`),console.log(playlistInfo),playlistText=playlistTemplate(playlistInfo,!0);let playlistElement=document.createRange().createContextualFragment(playlistText);overlay.appendChild(playlistElement)});else if(0===custom_playlists.length)console.log("no custom playlists");else for(customID of(console.log("multiple playlists"),custom_playlists))spotifyApi.getPlaylist(customID).then(playlistInfo=>{console.log(`got playlist by id ${customID}:`),console.log(playlistInfo),playlistText=playlistTemplate(playlistInfo,!0);let playlistElement=document.createRange().createContextualFragment(playlistText);overlay.appendChild(playlistElement),addRemoveListener()});overlay.innerHTML+=addElement,document.querySelector(".simplify-playlist.add-element .simplify-playlist-img").addEventListener("click",(function(){console.log("add playlist functionality goes here"),overlay.innerHTML+=addBox,addCustomsListener()})),overlay.style.display="block",icon.src="img/player.png",icon.className="playlist-icon close-playlists",document.getElementsByTagName("html")[0].style="width: 400px; height: 600px"}else icon.className="playlist-icon open-playlists",document.getElementsByTagName("html")[0].style="width: 400px; height: 200px",overlay.style.display="none",icon.src="img/playlists.png"})),document.getElementsByClassName("progress-marker pm1")[0].addEventListener("click",(function(){spotifyApi.seek(document.getElementsByClassName("progress-marker pm1")[0].id.replace("js-seek-","")).then(response=>{console.log("seeked to",document.getElementsByClassName("progress-marker pm1")[0].id.replace("js-seek-",""),"ms")})})),document.getElementsByClassName("progress-marker pm2")[0].addEventListener("click",(function(){spotifyApi.seek(document.getElementsByClassName("progress-marker pm2")[0].id.replace("js-seek-","")).then(response=>{console.log("seeked to",document.getElementsByClassName("progress-marker pm2")[0].id.replace("js-seek-",""),"ms")})})),document.getElementsByClassName("progress-marker pm3")[0].addEventListener("click",(function(){spotifyApi.seek(document.getElementsByClassName("progress-marker pm3")[0].id.replace("js-seek-","")).then(response=>{console.log("seeked to",document.getElementsByClassName("progress-marker pm3")[0].id.replace("js-seek-",""),"ms")})})),document.getElementsByClassName("progress-marker pm4")[0].addEventListener("click",(function(){spotifyApi.seek(document.getElementsByClassName("progress-marker pm4")[0].id.replace("js-seek-","")).then(response=>{console.log("seeked to",document.getElementsByClassName("progress-marker pm4")[0].id.replace("js-seek-",""),"ms")})})),chrome.storage.sync.get({"setting-filter":"none","setting-playlist-type":"user","setting-theme":"light","custom-playlists":[]},response=>{console.log("settings response:"),console.log(response),reloadSettings(simplifySetting=response)}),document.getElementById("js-setting-filter").addEventListener("click",(function(){document.getElementById("js-setting-filter").className.includes(" active")?simplifySetting["setting-filter"]="none":simplifySetting["setting-filter"]="b&w",reloadSettings(simplifySetting)})),document.getElementById("js-setting-playlist-type-trending").addEventListener("click",(function(){simplifySetting["setting-playlist-type"]="trending",reloadSettings(simplifySetting)})),document.getElementById("js-setting-playlist-type-user").addEventListener("click",(function(){simplifySetting["setting-playlist-type"]="user",reloadSettings(simplifySetting)})),document.getElementById("js-setting-playlist-type-featured").addEventListener("click",(function(){simplifySetting["setting-playlist-type"]="featured",reloadSettings(simplifySetting)})),document.getElementById("js-setting-playlist-type-custom").addEventListener("click",(function(){simplifySetting["setting-playlist-type"]="custom",reloadSettings(simplifySetting)}))}